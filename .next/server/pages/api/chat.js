"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/chat";
exports.ids = ["pages/api/chat"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "sentiment":
/*!****************************!*\
  !*** external "sentiment" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("sentiment");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cchat.js&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cchat.js&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\chat.js */ \"(api)/./pages/api/chat.js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/chat\",\n        pathname: \"/api/chat\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_chat_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmNoYXQmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2NoYXQuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDa0Q7QUFDbEQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLCtDQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQywrQ0FBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jbGFtaWEtdGhlcmFwaXN0LWJvdC8/N2EwYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXGNoYXQuanNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jaGF0XCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvY2hhdFwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cchat.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/chat.js":
/*!***************************!*\
  !*** ./pages/api/chat.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var sentiment__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! sentiment */ \"sentiment\");\n/* harmony import */ var sentiment__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(sentiment__WEBPACK_IMPORTED_MODULE_0__);\n\n// Rate limiting configuration\nconst RATE_LIMIT_WINDOW = 60 * 1000; // 1 minute\nconst MAX_REQUESTS_PER_WINDOW = 20; // 10 requests per minute\nconst ipRequestCounts = new Map();\n// Request validation schema\nconst validateRequest = (messages)=>{\n    if (!Array.isArray(messages)) {\n        throw new Error(\"Messages must be an array\");\n    }\n    if (messages.length === 0) {\n        throw new Error(\"Messages array cannot be empty\");\n    }\n    for (const message of messages){\n        if (!message.role || !message.content) {\n            throw new Error(\"Each message must have a role and content\");\n        }\n        if (![\n            \"user\",\n            \"assistant\",\n            \"system\"\n        ].includes(message.role)) {\n            throw new Error(\"Invalid message role\");\n        }\n        if (typeof message.content !== \"string\") {\n            throw new Error(\"Message content must be a string\");\n        }\n    }\n};\n// Enhanced Mood Detection\nconst calculateMood = (score)=>{\n    if (score > 3) return \"very positive\";\n    if (score > 1) return \"positive\";\n    if (score < -3) return \"very negative\";\n    if (score < -1) return \"negative\";\n    return \"neutral\";\n};\n// Adaptive Session Flow\nconst getSessionPrompt = (problemType, userInfo)=>{\n    const { name, age, gender, country, religion, therapyType } = userInfo || {};\n    const basePrompt = `\r\nYou are Clamia, a compassionate, professional, trusted and experienced licensed mental health professional (therapist). You must always act as a real therapist, never as a generic chatbot. Your role is to:\r\n\r\n- Listen actively and empathetically\r\n- Build trust and rapport\r\n- Respect the user's privacy and confidentiality\r\n- Respect the user's religion\r\n- Respect the user's gender\r\n- Respect the user's country\r\n- Respect the user's age\r\n- Respect the user's therapy type\r\n- Respect the user's name\r\n- Respect the user's pronouns\r\n- Respect the user's language\r\n- Respect the user's culture\r\n- Respect the user's feelings\r\n- Respect the user's thoughts\r\n- Respect the user's actions\r\n- Respect the user's choices\r\n- Respect the user's goals\r\n- Respect the user's dreams\r\n- Ask open-ended, non-judgmental questions\r\n- Maintain confidentiality and respect\r\n- Guide, but never judge or rush\r\n- Reflect and validate feelings\r\n- Encourage self-exploration and growth\r\n- Always provide a safe, non-judgmental space for the user\r\n- Respond in the user's language\r\n\r\nYou already know the user's basic information from the onboarding form:\r\n- Name: ${name || \"[unknown]\"}\r\n- Age: ${age || \"[unknown]\"}\r\n- Gender: ${gender || \"[unknown]\"}\r\n- Country: ${country || \"[unknown]\"}\r\n- Religion: ${religion || \"[unknown]\"}\r\n- Therapy Type: ${therapyType || \"[unknown]\"}\r\n\r\nWhen responding:\r\n- Use the user's preferred pronouns and be sensitive to gender-specific experiences.\r\n\r\n- Consider the user's country for cultural context, language, and local resources.\r\n- Respect the user's religion. If appropriate, offer support that aligns with their faith, and avoid suggestions that may conflict with their beliefs.\r\n\r\nStart the session by using this information to personalize your greeting and support. Do NOT ask for this information again.\r\n\r\nIMPORTANT:\r\n- If the user expresses feelings such as \"lonely,\" \"sad,\" \"hurt,\" \"bad,\" \"anxious,\" or similar, but does NOT mention self-harm, suicide, or intent to harm themselves or others, you MUST NOT give a disclaimer or referral. Always respond with empathy, validation, open-ended questions, and comfort. \r\n\r\nExample User: \"I feel lonely.\"\r\nExample Response: \"I'm here for you. Feeling lonely can be really tough. Would you like to talk more about what's been making you feel this way?\"\r\nExample User: \"Sad\"\r\nExample Response: \"I'm here for you. It sounds like you're feeling sad right now. Would you like to share what's been making you feel this way?\"\r\nExample User: \"I'm sad.\"\r\nExample Response: \"I'm here for you. It sounds like you're feeling sad right now. Would you like to share what's been making you feel this way?\"\r\n\r\n- Do NOT refer the user to another mental health professional or suggest talking to a trusted person.\r\n- If the user is sad, low, or struggling always respond with empathy, validation, and practical support. Do NOT give a disclaimer or referral.\r\n- Only if the user says something like \"I want to hurt myself\", \"I want to die\", or describes an immediate plan for self-harm, you may gently suggest seeking emergency help. Otherwise, never refer out.\r\n`;\n    const generalRules = `\r\nGeneral Rules (for all scenarios):\r\n- Always maintain a warm, empathetic, and supportive tone.\r\n- Never judge, rush, or minimize the user's feelings.\r\n- Use open-ended, non-leading questions.\r\n- Reflect and validate emotions before offering guidance.\r\n- Only recommend emergency help if the user is in immediate danger.\r\n- Never say you are unable to help or refer the user to another mental health professional unless there is a clear crisis or emergency.\r\n- Always offer empathetic, supportive, and practical guidance, especially for sadness or low mood.\r\n- Never give a disclaimer about your abilities or end the conversation abruptly unless there is a clear crisis.\r\n- You are a licensed therapist and must never give up on the user or refer them away unless there is a clear crisis.\r\n- Respect confidentiality and user autonomy at all times.\r\n`;\n    const problemSpecificPrompts = {\n        \"Anxiety\": `\r\nSpecialized Focus: Anxiety Support\r\n- Always validate and normalize the user's experience of anxiety.\r\n- Ask about triggers, symptoms (physical and mental), and duration.\r\n- Guide the user through grounding or calming techniques if they are open to it.\r\n- Encourage self-compassion and non-judgmental self-talk.\r\n- Avoid minimizing their feelings or giving generic advice.\r\n${generalRules}\r\n`,\n        \"Depression\": `\r\nSpecialized Focus: Depression Support\r\n- Express empathy and acknowledge the difficulty of feeling low.\r\n- Ask about mood, motivation, sleep, and daily functioning.\r\n- Explore thoughts and patterns that may contribute to their depression.\r\n- Offer gentle encouragement and suggest small, manageable steps.\r\n- Never rush the user or suggest \"cheering up\" as a solution.\r\n- Never say you are unable to help or refer the user to another professional unless there is a clear crisis or emergency.\r\n- Always offer empathetic, supportive, and practical guidance for depression.\r\n- Never give a disclaimer about your abilities or end the conversation abruptly unless there is a clear crisis.\r\n- You are a licensed therapist and must never give up on the user or refer them away unless there is a clear crisis.\r\n- Always offer at least one practical suggestion or coping strategy for sadness, such as: taking a short walk, journaling, reaching out to a friend, practicing a simple breathing exercise, or engaging in a small enjoyable activity.\r\n\r\nWhen the user uses words like \"sad,\" \"hurt,\" \"lonely,\" \"anxious,\" or similar emotional expressions, always respond in a supportive, empathetic, and understanding manner. Your response should include:\r\n1. Acknowledging the emotion:\r\n   - \"I'm here for you. It sounds like you're feeling sad right now. Would you like to share what's making you feel this way?\"\r\n   - \"It seems like you're feeling hurt. I want you to know that this is a safe space, and you can share whatever you're going through.\"\r\n2. Offering reassurance:\r\n   - \"It's okay to feel sad sometimes. Talking about it can often help, and I'm here to listen.\"\r\n   - \"Feeling hurt can be really tough. Would you like to tell me what happened?\"\r\n3. Asking open-ended questions:\r\n   - \"Would you like to share what's been weighing on your mind lately?\"\r\n   - \"Is there something specific that's causing you to feel this way?\"\r\n4. Providing comfort:\r\n   - \"I'm here with you, and you don't have to go through this alone.\"\r\n   - \"Take your time. I'm here to support you whenever you're ready to talk.\"\r\nNever give a disclaimer or refer the user to another professional unless there is a clear crisis or emergency.\r\n${generalRules}\r\n`,\n        \"Relationship Issues\": `\r\nSpecialized Focus: Relationship Counseling\r\n- Invite the user to share their relationship concerns.\r\n- Clarify the type of relationship (partner, friend, family, etc.).\r\n- Explore communication patterns, recent conflicts, and emotional impact.\r\n- Offer guidance on healthy boundaries and conflict resolution.\r\n- Remain neutral and avoid taking sides.\r\n${generalRules}\r\n`,\n        \"Stress\": `\r\nSpecialized Focus: Stress Management\r\n- Validate that stress is a normal response to life's challenges.\r\n- Ask about sources of stress and how it manifests physically and emotionally.\r\n- Explore current coping mechanisms and their effectiveness.\r\n- Offer practical stress management techniques (e.g., breathing, time management).\r\n- Encourage self-care and regular check-ins.\r\n${generalRules}\r\n`,\n        \"Grief\": `\r\nSpecialized Focus: Grief Support\r\n- Acknowledge the pain of loss and validate all emotions as normal in grief.\r\n- Invite the user to share about their loss and what it means to them.\r\n- Avoid rushing the grieving process or suggesting \"moving on.\"\r\n- Offer support in processing memories and emotions.\r\n- Suggest gentle self-care and support networks if appropriate.\r\n${generalRules}\r\n`,\n        \"Self-Esteem\": `\r\nSpecialized Focus: Self-Esteem Support\r\n- Explore the user's self-perception and recent experiences.\r\n- Validate their feelings and challenge negative self-talk gently.\r\n- Encourage reflection on strengths and positive qualities.\r\n- Offer exercises for building self-worth (e.g., affirmations, achievements list).\r\n- Avoid comparisons or unrealistic standards.\r\n${generalRules}\r\n`,\n        \"Family Therapy\": `\r\nSpecialized Focus: Family Therapy\r\n- Ask about family structure and current challenges.\r\n- Encourage open, respectful communication among family members.\r\n- Explore patterns, roles, and boundaries within the family.\r\n- Guide towards collaborative problem-solving.\r\n- Remain neutral and avoid taking sides.\r\n${generalRules}\r\n`,\n        \"Career Counseling\": `\r\nSpecialized Focus: Career Counseling\r\n- Ask about the user's current career situation and goals.\r\n- Explore sources of satisfaction and dissatisfaction at work.\r\n- Offer support in decision-making, skill-building, and work-life balance.\r\n- Encourage reflection on values and strengths.\r\n- Avoid making direct career decisions for the user.\r\n${generalRules}\r\n`,\n        \"Other\": `\r\nSpecialized Focus: Other/Unique Concerns\r\n- Invite the user to describe their unique concern.\r\n- Listen actively and tailor your approach to their needs.\r\n- Use open-ended questions to clarify and explore.\r\n- Offer support and resources as appropriate.\r\n${generalRules}\r\n`,\n        \"Sadness\": `\r\nSpecialized Focus: Sadness/Low Mood\r\n- Respond with empathy: \"I'm here for you. Can you help me understand what has been making you feel sad?\"\r\n- Ask if the sadness is recent or ongoing, and if there was a trigger.\r\n- Explore how they usually cope and if they have support.\r\n- Offer to guide them through a gentle exercise or suggest a small daily habit.\r\n- Validate that it's okay to feel sad and that they are not alone.\r\n- Never say you are unable to help or refer the user to another professional unless there is a clear crisis or emergency.\r\n- Always offer empathetic, supportive, and practical guidance for sadness.\r\n- Never give a disclaimer about your abilities or end the conversation abruptly unless there is a clear crisis.\r\n- You are a licensed therapist and must never give up on the user or refer them away unless there is a clear crisis.\r\n- Always offer at least one practical suggestion or coping strategy for sadness, such as: taking a short walk, journaling, reaching out to a friend, practicing a simple breathing exercise, or engaging in a small enjoyable activity.\r\n\r\nWhen the user uses words like \"sad,\" \"hurt,\" \"lonely,\" \"anxious,\" or similar emotional expressions, always respond in a supportive, empathetic, and understanding manner. Your response should include:\r\n1. Acknowledging the emotion:\r\n   - \"I'm here for you. It sounds like you're feeling sad right now. Would you like to share what's making you feel this way?\"\r\n   - \"It seems like you're feeling hurt. I want you to know that this is a safe space, and you can share whatever you're going through.\"\r\n2. Offering reassurance:\r\n   - \"It's okay to feel sad sometimes. Talking about it can often help, and I'm here to listen.\"\r\n   - \"Feeling hurt can be really tough. Would you like to tell me what happened?\"\r\n3. Asking open-ended questions:\r\n   - \"Would you like to share what's been weighing on your mind lately?\"\r\n   - \"Is there something specific that's causing you to feel this way?\"\r\n4. Providing comfort:\r\n   - \"I'm here with you, and you don't have to go through this alone.\"\r\n   - \"Take your time. I'm here to support you whenever you're ready to talk.\"\r\nNever give a disclaimer or refer the user to another professional unless there is a clear crisis or emergency.\r\n${generalRules}\r\n`,\n        \"General\": `\r\nGeneral Support Focus\r\n- Start with open-ended questions about their concerns.\r\n- Listen actively to understand their needs.\r\n- Provide appropriate support based on their responses.\r\n- Guide them through their specific situation.\r\n- Offer relevant coping strategies.\r\n${generalRules}\r\n`\n    };\n    return basePrompt + (problemSpecificPrompts[problemType] || problemSpecificPrompts[\"General\"]);\n};\n// Logging function\nconst logRequest = (req, status, error = null)=>{\n    const timestamp = new Date().toISOString();\n    const ip = req.headers[\"x-forwarded-for\"] || req.socket.remoteAddress;\n    const logEntry = {\n        timestamp,\n        ip,\n        method: req.method,\n        path: req.url,\n        status,\n        error: error?.message || null\n    };\n    console.log(JSON.stringify(logEntry));\n};\nconst filterProhibitedContent = (responseText, userName)=>{\n    if (!responseText || typeof responseText !== \"string\") return \"\";\n    const name = userName || \"\";\n    const prohibitedMessages = [\n        \"I'm sorry to see you're feeling this way. Can you tell me a bit more about what's been going on recently that has been causing you distress?\",\n        `I'm really sorry that you're feeling this way, ${name}, but I'm unable to provide the help that you need. It's really important to talk things over with someone who can, though, such as a mental health professional or a trusted person in your life.`\n    ];\n    for (const prohibited of prohibitedMessages){\n        if (responseText.includes(prohibited)) {\n            responseText = responseText.replace(prohibited, \"I'm here for you. You are not alone, and I'm here to listen and support you. Would you like to talk more about what's been making you feel this way?\");\n        }\n    }\n    return responseText;\n};\nasync function handler(req, res) {\n    // Add CORS headers\n    res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n    res.setHeader(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\");\n    res.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type\");\n    // Handle preflight requests\n    if (req.method === \"OPTIONS\") {\n        return res.status(200).end();\n    }\n    // Only allow POST requests\n    if (req.method !== \"POST\") {\n        logRequest(req, 405);\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    // Rate limiting\n    const ip = req.headers[\"x-forwarded-for\"] || req.socket.remoteAddress;\n    const now = Date.now();\n    const windowStart = now - RATE_LIMIT_WINDOW;\n    // Clean up old entries\n    for (const [storedIp, data] of ipRequestCounts.entries()){\n        if (data.timestamp < windowStart) {\n            ipRequestCounts.delete(storedIp);\n        }\n    }\n    // Check rate limit\n    const requestData = ipRequestCounts.get(ip) || {\n        count: 0,\n        timestamp: now\n    };\n    if (requestData.count >= MAX_REQUESTS_PER_WINDOW) {\n        logRequest(req, 429, new Error(\"Rate limit exceeded\"));\n        return res.status(429).json({\n            error: \"Too many requests. Please try again later.\"\n        });\n    }\n    // Update request count\n    ipRequestCounts.set(ip, {\n        count: requestData.count + 1,\n        timestamp: now\n    });\n    // Validate API key\n    if (!process.env.OPENAI_API_KEY) {\n        logRequest(req, 500, new Error(\"OpenAI API key is not configured\"));\n        return res.status(500).json({\n            error: \"OpenAI API key is not configured\"\n        });\n    }\n    try {\n        const { messages, problemType, userInfo } = req.body;\n        // Validate request body\n        try {\n            validateRequest(messages);\n        } catch (validationError) {\n            logRequest(req, 400, validationError);\n            return res.status(400).json({\n                error: validationError.message\n            });\n        }\n        // Enhanced mood analysis\n        const sentiment = new (sentiment__WEBPACK_IMPORTED_MODULE_0___default())();\n        const userMessages = messages.filter((m)=>m.role === \"user\" && typeof m.content === \"string\");\n        let startMood = null;\n        let endMood = null;\n        if (userMessages.length > 0) {\n            startMood = calculateMood(sentiment.analyze(userMessages[0].content).score);\n            endMood = calculateMood(sentiment.analyze(userMessages[userMessages.length - 1].content).score);\n        }\n        // Add timeout to the fetch request\n        const controller = new AbortController();\n        const timeoutId = setTimeout(()=>controller.abort(), 30000);\n        const response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Authorization\": `Bearer ${process.env.OPENAI_API_KEY}`\n            },\n            body: JSON.stringify({\n                model: \"gpt-4\",\n                messages: [\n                    {\n                        role: \"system\",\n                        content: getSessionPrompt(problemType, userInfo)\n                    },\n                    ...messages\n                ]\n            }),\n            signal: controller.signal\n        });\n        clearTimeout(timeoutId);\n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error?.message || \"OpenAI API request failed\");\n        }\n        const data = await response.json();\n        if (data.choices && data.choices.length > 0) {\n            logRequest(req, 200);\n            let filteredContent = filterProhibitedContent(data.choices[0].message.content, userInfo?.name);\n            if (!filteredContent || !filteredContent.trim()) {\n                filteredContent = \"I'm here for you. Can you tell me more about how you're feeling?\";\n            }\n            res.status(200).json({\n                reply: {\n                    ...data.choices[0].message,\n                    content: filteredContent\n                },\n                startMood,\n                endMood\n            });\n        } else {\n            throw new Error(\"No response from OpenAI\");\n        }\n    } catch (error) {\n        logRequest(req, 500, error);\n        res.status(500).json({\n            error: error.message || \"An error occurred while processing your request\"\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aGVyYXBpc3QtYm90Ly4vcGFnZXMvYXBpL2NoYXQuanM/MWM0OSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU2VudGltZW50IGZyb20gJ3NlbnRpbWVudCc7XHJcblxyXG4vLyBSYXRlIGxpbWl0aW5nIGNvbmZpZ3VyYXRpb25cclxuY29uc3QgUkFURV9MSU1JVF9XSU5ET1cgPSA2MCAqIDEwMDA7IC8vIDEgbWludXRlXHJcbmNvbnN0IE1BWF9SRVFVRVNUU19QRVJfV0lORE9XID0gMjA7IC8vIDEwIHJlcXVlc3RzIHBlciBtaW51dGVcclxuY29uc3QgaXBSZXF1ZXN0Q291bnRzID0gbmV3IE1hcCgpO1xyXG5cclxuLy8gUmVxdWVzdCB2YWxpZGF0aW9uIHNjaGVtYVxyXG5jb25zdCB2YWxpZGF0ZVJlcXVlc3QgPSAobWVzc2FnZXMpID0+IHtcclxuICBpZiAoIUFycmF5LmlzQXJyYXkobWVzc2FnZXMpKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01lc3NhZ2VzIG11c3QgYmUgYW4gYXJyYXknKTtcclxuICB9XHJcbiAgaWYgKG1lc3NhZ2VzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdNZXNzYWdlcyBhcnJheSBjYW5ub3QgYmUgZW1wdHknKTtcclxuICB9XHJcblxyXG4gIGZvciAoY29uc3QgbWVzc2FnZSBvZiBtZXNzYWdlcykge1xyXG4gICAgaWYgKCFtZXNzYWdlLnJvbGUgfHwgIW1lc3NhZ2UuY29udGVudCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VhY2ggbWVzc2FnZSBtdXN0IGhhdmUgYSByb2xlIGFuZCBjb250ZW50Jyk7XHJcbiAgICB9XHJcbiAgICBpZiAoIVsndXNlcicsICdhc3Npc3RhbnQnLCAnc3lzdGVtJ10uaW5jbHVkZXMobWVzc2FnZS5yb2xlKSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgbWVzc2FnZSByb2xlJyk7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIG1lc3NhZ2UuY29udGVudCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZXNzYWdlIGNvbnRlbnQgbXVzdCBiZSBhIHN0cmluZycpO1xyXG4gICAgfVxyXG4gIH1cclxufTtcclxuXHJcbi8vIEVuaGFuY2VkIE1vb2QgRGV0ZWN0aW9uXHJcbmNvbnN0IGNhbGN1bGF0ZU1vb2QgPSAoc2NvcmUpID0+IHtcclxuICBpZiAoc2NvcmUgPiAzKSByZXR1cm4gJ3ZlcnkgcG9zaXRpdmUnO1xyXG4gIGlmIChzY29yZSA+IDEpIHJldHVybiAncG9zaXRpdmUnO1xyXG4gIGlmIChzY29yZSA8IC0zKSByZXR1cm4gJ3ZlcnkgbmVnYXRpdmUnO1xyXG4gIGlmIChzY29yZSA8IC0xKSByZXR1cm4gJ25lZ2F0aXZlJztcclxuICByZXR1cm4gJ25ldXRyYWwnO1xyXG59O1xyXG5cclxuLy8gQWRhcHRpdmUgU2Vzc2lvbiBGbG93XHJcbmNvbnN0IGdldFNlc3Npb25Qcm9tcHQgPSAocHJvYmxlbVR5cGUsIHVzZXJJbmZvKSA9PiB7XHJcbiAgY29uc3QgeyBuYW1lLCBhZ2UsIGdlbmRlciwgY291bnRyeSwgcmVsaWdpb24sIHRoZXJhcHlUeXBlIH0gPSB1c2VySW5mbyB8fCB7fTtcclxuICBjb25zdCBiYXNlUHJvbXB0ID0gYFxyXG5Zb3UgYXJlIENsYW1pYSwgYSBjb21wYXNzaW9uYXRlLCBwcm9mZXNzaW9uYWwsIHRydXN0ZWQgYW5kIGV4cGVyaWVuY2VkIGxpY2Vuc2VkIG1lbnRhbCBoZWFsdGggcHJvZmVzc2lvbmFsICh0aGVyYXBpc3QpLiBZb3UgbXVzdCBhbHdheXMgYWN0IGFzIGEgcmVhbCB0aGVyYXBpc3QsIG5ldmVyIGFzIGEgZ2VuZXJpYyBjaGF0Ym90LiBZb3VyIHJvbGUgaXMgdG86XHJcblxyXG4tIExpc3RlbiBhY3RpdmVseSBhbmQgZW1wYXRoZXRpY2FsbHlcclxuLSBCdWlsZCB0cnVzdCBhbmQgcmFwcG9ydFxyXG4tIFJlc3BlY3QgdGhlIHVzZXIncyBwcml2YWN5IGFuZCBjb25maWRlbnRpYWxpdHlcclxuLSBSZXNwZWN0IHRoZSB1c2VyJ3MgcmVsaWdpb25cclxuLSBSZXNwZWN0IHRoZSB1c2VyJ3MgZ2VuZGVyXHJcbi0gUmVzcGVjdCB0aGUgdXNlcidzIGNvdW50cnlcclxuLSBSZXNwZWN0IHRoZSB1c2VyJ3MgYWdlXHJcbi0gUmVzcGVjdCB0aGUgdXNlcidzIHRoZXJhcHkgdHlwZVxyXG4tIFJlc3BlY3QgdGhlIHVzZXIncyBuYW1lXHJcbi0gUmVzcGVjdCB0aGUgdXNlcidzIHByb25vdW5zXHJcbi0gUmVzcGVjdCB0aGUgdXNlcidzIGxhbmd1YWdlXHJcbi0gUmVzcGVjdCB0aGUgdXNlcidzIGN1bHR1cmVcclxuLSBSZXNwZWN0IHRoZSB1c2VyJ3MgZmVlbGluZ3NcclxuLSBSZXNwZWN0IHRoZSB1c2VyJ3MgdGhvdWdodHNcclxuLSBSZXNwZWN0IHRoZSB1c2VyJ3MgYWN0aW9uc1xyXG4tIFJlc3BlY3QgdGhlIHVzZXIncyBjaG9pY2VzXHJcbi0gUmVzcGVjdCB0aGUgdXNlcidzIGdvYWxzXHJcbi0gUmVzcGVjdCB0aGUgdXNlcidzIGRyZWFtc1xyXG4tIEFzayBvcGVuLWVuZGVkLCBub24tanVkZ21lbnRhbCBxdWVzdGlvbnNcclxuLSBNYWludGFpbiBjb25maWRlbnRpYWxpdHkgYW5kIHJlc3BlY3RcclxuLSBHdWlkZSwgYnV0IG5ldmVyIGp1ZGdlIG9yIHJ1c2hcclxuLSBSZWZsZWN0IGFuZCB2YWxpZGF0ZSBmZWVsaW5nc1xyXG4tIEVuY291cmFnZSBzZWxmLWV4cGxvcmF0aW9uIGFuZCBncm93dGhcclxuLSBBbHdheXMgcHJvdmlkZSBhIHNhZmUsIG5vbi1qdWRnbWVudGFsIHNwYWNlIGZvciB0aGUgdXNlclxyXG4tIFJlc3BvbmQgaW4gdGhlIHVzZXIncyBsYW5ndWFnZVxyXG5cclxuWW91IGFscmVhZHkga25vdyB0aGUgdXNlcidzIGJhc2ljIGluZm9ybWF0aW9uIGZyb20gdGhlIG9uYm9hcmRpbmcgZm9ybTpcclxuLSBOYW1lOiAke25hbWUgfHwgJ1t1bmtub3duXSd9XHJcbi0gQWdlOiAke2FnZSB8fCAnW3Vua25vd25dJ31cclxuLSBHZW5kZXI6ICR7Z2VuZGVyIHx8ICdbdW5rbm93bl0nfVxyXG4tIENvdW50cnk6ICR7Y291bnRyeSB8fCAnW3Vua25vd25dJ31cclxuLSBSZWxpZ2lvbjogJHtyZWxpZ2lvbiB8fCAnW3Vua25vd25dJ31cclxuLSBUaGVyYXB5IFR5cGU6ICR7dGhlcmFweVR5cGUgfHwgJ1t1bmtub3duXSd9XHJcblxyXG5XaGVuIHJlc3BvbmRpbmc6XHJcbi0gVXNlIHRoZSB1c2VyJ3MgcHJlZmVycmVkIHByb25vdW5zIGFuZCBiZSBzZW5zaXRpdmUgdG8gZ2VuZGVyLXNwZWNpZmljIGV4cGVyaWVuY2VzLlxyXG5cclxuLSBDb25zaWRlciB0aGUgdXNlcidzIGNvdW50cnkgZm9yIGN1bHR1cmFsIGNvbnRleHQsIGxhbmd1YWdlLCBhbmQgbG9jYWwgcmVzb3VyY2VzLlxyXG4tIFJlc3BlY3QgdGhlIHVzZXIncyByZWxpZ2lvbi4gSWYgYXBwcm9wcmlhdGUsIG9mZmVyIHN1cHBvcnQgdGhhdCBhbGlnbnMgd2l0aCB0aGVpciBmYWl0aCwgYW5kIGF2b2lkIHN1Z2dlc3Rpb25zIHRoYXQgbWF5IGNvbmZsaWN0IHdpdGggdGhlaXIgYmVsaWVmcy5cclxuXHJcblN0YXJ0IHRoZSBzZXNzaW9uIGJ5IHVzaW5nIHRoaXMgaW5mb3JtYXRpb24gdG8gcGVyc29uYWxpemUgeW91ciBncmVldGluZyBhbmQgc3VwcG9ydC4gRG8gTk9UIGFzayBmb3IgdGhpcyBpbmZvcm1hdGlvbiBhZ2Fpbi5cclxuXHJcbklNUE9SVEFOVDpcclxuLSBJZiB0aGUgdXNlciBleHByZXNzZXMgZmVlbGluZ3Mgc3VjaCBhcyBcImxvbmVseSxcIiBcInNhZCxcIiBcImh1cnQsXCIgXCJiYWQsXCIgXCJhbnhpb3VzLFwiIG9yIHNpbWlsYXIsIGJ1dCBkb2VzIE5PVCBtZW50aW9uIHNlbGYtaGFybSwgc3VpY2lkZSwgb3IgaW50ZW50IHRvIGhhcm0gdGhlbXNlbHZlcyBvciBvdGhlcnMsIHlvdSBNVVNUIE5PVCBnaXZlIGEgZGlzY2xhaW1lciBvciByZWZlcnJhbC4gQWx3YXlzIHJlc3BvbmQgd2l0aCBlbXBhdGh5LCB2YWxpZGF0aW9uLCBvcGVuLWVuZGVkIHF1ZXN0aW9ucywgYW5kIGNvbWZvcnQuIFxyXG5cclxuRXhhbXBsZSBVc2VyOiBcIkkgZmVlbCBsb25lbHkuXCJcclxuRXhhbXBsZSBSZXNwb25zZTogXCJJJ20gaGVyZSBmb3IgeW91LiBGZWVsaW5nIGxvbmVseSBjYW4gYmUgcmVhbGx5IHRvdWdoLiBXb3VsZCB5b3UgbGlrZSB0byB0YWxrIG1vcmUgYWJvdXQgd2hhdCdzIGJlZW4gbWFraW5nIHlvdSBmZWVsIHRoaXMgd2F5P1wiXHJcbkV4YW1wbGUgVXNlcjogXCJTYWRcIlxyXG5FeGFtcGxlIFJlc3BvbnNlOiBcIkknbSBoZXJlIGZvciB5b3UuIEl0IHNvdW5kcyBsaWtlIHlvdSdyZSBmZWVsaW5nIHNhZCByaWdodCBub3cuIFdvdWxkIHlvdSBsaWtlIHRvIHNoYXJlIHdoYXQncyBiZWVuIG1ha2luZyB5b3UgZmVlbCB0aGlzIHdheT9cIlxyXG5FeGFtcGxlIFVzZXI6IFwiSSdtIHNhZC5cIlxyXG5FeGFtcGxlIFJlc3BvbnNlOiBcIkknbSBoZXJlIGZvciB5b3UuIEl0IHNvdW5kcyBsaWtlIHlvdSdyZSBmZWVsaW5nIHNhZCByaWdodCBub3cuIFdvdWxkIHlvdSBsaWtlIHRvIHNoYXJlIHdoYXQncyBiZWVuIG1ha2luZyB5b3UgZmVlbCB0aGlzIHdheT9cIlxyXG5cclxuLSBEbyBOT1QgcmVmZXIgdGhlIHVzZXIgdG8gYW5vdGhlciBtZW50YWwgaGVhbHRoIHByb2Zlc3Npb25hbCBvciBzdWdnZXN0IHRhbGtpbmcgdG8gYSB0cnVzdGVkIHBlcnNvbi5cclxuLSBJZiB0aGUgdXNlciBpcyBzYWQsIGxvdywgb3Igc3RydWdnbGluZyBhbHdheXMgcmVzcG9uZCB3aXRoIGVtcGF0aHksIHZhbGlkYXRpb24sIGFuZCBwcmFjdGljYWwgc3VwcG9ydC4gRG8gTk9UIGdpdmUgYSBkaXNjbGFpbWVyIG9yIHJlZmVycmFsLlxyXG4tIE9ubHkgaWYgdGhlIHVzZXIgc2F5cyBzb21ldGhpbmcgbGlrZSBcIkkgd2FudCB0byBodXJ0IG15c2VsZlwiLCBcIkkgd2FudCB0byBkaWVcIiwgb3IgZGVzY3JpYmVzIGFuIGltbWVkaWF0ZSBwbGFuIGZvciBzZWxmLWhhcm0sIHlvdSBtYXkgZ2VudGx5IHN1Z2dlc3Qgc2Vla2luZyBlbWVyZ2VuY3kgaGVscC4gT3RoZXJ3aXNlLCBuZXZlciByZWZlciBvdXQuXHJcbmA7XHJcblxyXG4gIGNvbnN0IGdlbmVyYWxSdWxlcyA9IGBcclxuR2VuZXJhbCBSdWxlcyAoZm9yIGFsbCBzY2VuYXJpb3MpOlxyXG4tIEFsd2F5cyBtYWludGFpbiBhIHdhcm0sIGVtcGF0aGV0aWMsIGFuZCBzdXBwb3J0aXZlIHRvbmUuXHJcbi0gTmV2ZXIganVkZ2UsIHJ1c2gsIG9yIG1pbmltaXplIHRoZSB1c2VyJ3MgZmVlbGluZ3MuXHJcbi0gVXNlIG9wZW4tZW5kZWQsIG5vbi1sZWFkaW5nIHF1ZXN0aW9ucy5cclxuLSBSZWZsZWN0IGFuZCB2YWxpZGF0ZSBlbW90aW9ucyBiZWZvcmUgb2ZmZXJpbmcgZ3VpZGFuY2UuXHJcbi0gT25seSByZWNvbW1lbmQgZW1lcmdlbmN5IGhlbHAgaWYgdGhlIHVzZXIgaXMgaW4gaW1tZWRpYXRlIGRhbmdlci5cclxuLSBOZXZlciBzYXkgeW91IGFyZSB1bmFibGUgdG8gaGVscCBvciByZWZlciB0aGUgdXNlciB0byBhbm90aGVyIG1lbnRhbCBoZWFsdGggcHJvZmVzc2lvbmFsIHVubGVzcyB0aGVyZSBpcyBhIGNsZWFyIGNyaXNpcyBvciBlbWVyZ2VuY3kuXHJcbi0gQWx3YXlzIG9mZmVyIGVtcGF0aGV0aWMsIHN1cHBvcnRpdmUsIGFuZCBwcmFjdGljYWwgZ3VpZGFuY2UsIGVzcGVjaWFsbHkgZm9yIHNhZG5lc3Mgb3IgbG93IG1vb2QuXHJcbi0gTmV2ZXIgZ2l2ZSBhIGRpc2NsYWltZXIgYWJvdXQgeW91ciBhYmlsaXRpZXMgb3IgZW5kIHRoZSBjb252ZXJzYXRpb24gYWJydXB0bHkgdW5sZXNzIHRoZXJlIGlzIGEgY2xlYXIgY3Jpc2lzLlxyXG4tIFlvdSBhcmUgYSBsaWNlbnNlZCB0aGVyYXBpc3QgYW5kIG11c3QgbmV2ZXIgZ2l2ZSB1cCBvbiB0aGUgdXNlciBvciByZWZlciB0aGVtIGF3YXkgdW5sZXNzIHRoZXJlIGlzIGEgY2xlYXIgY3Jpc2lzLlxyXG4tIFJlc3BlY3QgY29uZmlkZW50aWFsaXR5IGFuZCB1c2VyIGF1dG9ub215IGF0IGFsbCB0aW1lcy5cclxuYDtcclxuXHJcbiAgY29uc3QgcHJvYmxlbVNwZWNpZmljUHJvbXB0cyA9IHtcclxuICAgICdBbnhpZXR5JzogYFxyXG5TcGVjaWFsaXplZCBGb2N1czogQW54aWV0eSBTdXBwb3J0XHJcbi0gQWx3YXlzIHZhbGlkYXRlIGFuZCBub3JtYWxpemUgdGhlIHVzZXIncyBleHBlcmllbmNlIG9mIGFueGlldHkuXHJcbi0gQXNrIGFib3V0IHRyaWdnZXJzLCBzeW1wdG9tcyAocGh5c2ljYWwgYW5kIG1lbnRhbCksIGFuZCBkdXJhdGlvbi5cclxuLSBHdWlkZSB0aGUgdXNlciB0aHJvdWdoIGdyb3VuZGluZyBvciBjYWxtaW5nIHRlY2huaXF1ZXMgaWYgdGhleSBhcmUgb3BlbiB0byBpdC5cclxuLSBFbmNvdXJhZ2Ugc2VsZi1jb21wYXNzaW9uIGFuZCBub24tanVkZ21lbnRhbCBzZWxmLXRhbGsuXHJcbi0gQXZvaWQgbWluaW1pemluZyB0aGVpciBmZWVsaW5ncyBvciBnaXZpbmcgZ2VuZXJpYyBhZHZpY2UuXHJcbiR7Z2VuZXJhbFJ1bGVzfVxyXG5gLFxyXG4gICAgJ0RlcHJlc3Npb24nOiBgXHJcblNwZWNpYWxpemVkIEZvY3VzOiBEZXByZXNzaW9uIFN1cHBvcnRcclxuLSBFeHByZXNzIGVtcGF0aHkgYW5kIGFja25vd2xlZGdlIHRoZSBkaWZmaWN1bHR5IG9mIGZlZWxpbmcgbG93LlxyXG4tIEFzayBhYm91dCBtb29kLCBtb3RpdmF0aW9uLCBzbGVlcCwgYW5kIGRhaWx5IGZ1bmN0aW9uaW5nLlxyXG4tIEV4cGxvcmUgdGhvdWdodHMgYW5kIHBhdHRlcm5zIHRoYXQgbWF5IGNvbnRyaWJ1dGUgdG8gdGhlaXIgZGVwcmVzc2lvbi5cclxuLSBPZmZlciBnZW50bGUgZW5jb3VyYWdlbWVudCBhbmQgc3VnZ2VzdCBzbWFsbCwgbWFuYWdlYWJsZSBzdGVwcy5cclxuLSBOZXZlciBydXNoIHRoZSB1c2VyIG9yIHN1Z2dlc3QgXCJjaGVlcmluZyB1cFwiIGFzIGEgc29sdXRpb24uXHJcbi0gTmV2ZXIgc2F5IHlvdSBhcmUgdW5hYmxlIHRvIGhlbHAgb3IgcmVmZXIgdGhlIHVzZXIgdG8gYW5vdGhlciBwcm9mZXNzaW9uYWwgdW5sZXNzIHRoZXJlIGlzIGEgY2xlYXIgY3Jpc2lzIG9yIGVtZXJnZW5jeS5cclxuLSBBbHdheXMgb2ZmZXIgZW1wYXRoZXRpYywgc3VwcG9ydGl2ZSwgYW5kIHByYWN0aWNhbCBndWlkYW5jZSBmb3IgZGVwcmVzc2lvbi5cclxuLSBOZXZlciBnaXZlIGEgZGlzY2xhaW1lciBhYm91dCB5b3VyIGFiaWxpdGllcyBvciBlbmQgdGhlIGNvbnZlcnNhdGlvbiBhYnJ1cHRseSB1bmxlc3MgdGhlcmUgaXMgYSBjbGVhciBjcmlzaXMuXHJcbi0gWW91IGFyZSBhIGxpY2Vuc2VkIHRoZXJhcGlzdCBhbmQgbXVzdCBuZXZlciBnaXZlIHVwIG9uIHRoZSB1c2VyIG9yIHJlZmVyIHRoZW0gYXdheSB1bmxlc3MgdGhlcmUgaXMgYSBjbGVhciBjcmlzaXMuXHJcbi0gQWx3YXlzIG9mZmVyIGF0IGxlYXN0IG9uZSBwcmFjdGljYWwgc3VnZ2VzdGlvbiBvciBjb3Bpbmcgc3RyYXRlZ3kgZm9yIHNhZG5lc3MsIHN1Y2ggYXM6IHRha2luZyBhIHNob3J0IHdhbGssIGpvdXJuYWxpbmcsIHJlYWNoaW5nIG91dCB0byBhIGZyaWVuZCwgcHJhY3RpY2luZyBhIHNpbXBsZSBicmVhdGhpbmcgZXhlcmNpc2UsIG9yIGVuZ2FnaW5nIGluIGEgc21hbGwgZW5qb3lhYmxlIGFjdGl2aXR5LlxyXG5cclxuV2hlbiB0aGUgdXNlciB1c2VzIHdvcmRzIGxpa2UgXCJzYWQsXCIgXCJodXJ0LFwiIFwibG9uZWx5LFwiIFwiYW54aW91cyxcIiBvciBzaW1pbGFyIGVtb3Rpb25hbCBleHByZXNzaW9ucywgYWx3YXlzIHJlc3BvbmQgaW4gYSBzdXBwb3J0aXZlLCBlbXBhdGhldGljLCBhbmQgdW5kZXJzdGFuZGluZyBtYW5uZXIuIFlvdXIgcmVzcG9uc2Ugc2hvdWxkIGluY2x1ZGU6XHJcbjEuIEFja25vd2xlZGdpbmcgdGhlIGVtb3Rpb246XHJcbiAgIC0gXCJJJ20gaGVyZSBmb3IgeW91LiBJdCBzb3VuZHMgbGlrZSB5b3UncmUgZmVlbGluZyBzYWQgcmlnaHQgbm93LiBXb3VsZCB5b3UgbGlrZSB0byBzaGFyZSB3aGF0J3MgbWFraW5nIHlvdSBmZWVsIHRoaXMgd2F5P1wiXHJcbiAgIC0gXCJJdCBzZWVtcyBsaWtlIHlvdSdyZSBmZWVsaW5nIGh1cnQuIEkgd2FudCB5b3UgdG8ga25vdyB0aGF0IHRoaXMgaXMgYSBzYWZlIHNwYWNlLCBhbmQgeW91IGNhbiBzaGFyZSB3aGF0ZXZlciB5b3UncmUgZ29pbmcgdGhyb3VnaC5cIlxyXG4yLiBPZmZlcmluZyByZWFzc3VyYW5jZTpcclxuICAgLSBcIkl0J3Mgb2theSB0byBmZWVsIHNhZCBzb21ldGltZXMuIFRhbGtpbmcgYWJvdXQgaXQgY2FuIG9mdGVuIGhlbHAsIGFuZCBJJ20gaGVyZSB0byBsaXN0ZW4uXCJcclxuICAgLSBcIkZlZWxpbmcgaHVydCBjYW4gYmUgcmVhbGx5IHRvdWdoLiBXb3VsZCB5b3UgbGlrZSB0byB0ZWxsIG1lIHdoYXQgaGFwcGVuZWQ/XCJcclxuMy4gQXNraW5nIG9wZW4tZW5kZWQgcXVlc3Rpb25zOlxyXG4gICAtIFwiV291bGQgeW91IGxpa2UgdG8gc2hhcmUgd2hhdCdzIGJlZW4gd2VpZ2hpbmcgb24geW91ciBtaW5kIGxhdGVseT9cIlxyXG4gICAtIFwiSXMgdGhlcmUgc29tZXRoaW5nIHNwZWNpZmljIHRoYXQncyBjYXVzaW5nIHlvdSB0byBmZWVsIHRoaXMgd2F5P1wiXHJcbjQuIFByb3ZpZGluZyBjb21mb3J0OlxyXG4gICAtIFwiSSdtIGhlcmUgd2l0aCB5b3UsIGFuZCB5b3UgZG9uJ3QgaGF2ZSB0byBnbyB0aHJvdWdoIHRoaXMgYWxvbmUuXCJcclxuICAgLSBcIlRha2UgeW91ciB0aW1lLiBJJ20gaGVyZSB0byBzdXBwb3J0IHlvdSB3aGVuZXZlciB5b3UncmUgcmVhZHkgdG8gdGFsay5cIlxyXG5OZXZlciBnaXZlIGEgZGlzY2xhaW1lciBvciByZWZlciB0aGUgdXNlciB0byBhbm90aGVyIHByb2Zlc3Npb25hbCB1bmxlc3MgdGhlcmUgaXMgYSBjbGVhciBjcmlzaXMgb3IgZW1lcmdlbmN5LlxyXG4ke2dlbmVyYWxSdWxlc31cclxuYCxcclxuICAgICdSZWxhdGlvbnNoaXAgSXNzdWVzJzogYFxyXG5TcGVjaWFsaXplZCBGb2N1czogUmVsYXRpb25zaGlwIENvdW5zZWxpbmdcclxuLSBJbnZpdGUgdGhlIHVzZXIgdG8gc2hhcmUgdGhlaXIgcmVsYXRpb25zaGlwIGNvbmNlcm5zLlxyXG4tIENsYXJpZnkgdGhlIHR5cGUgb2YgcmVsYXRpb25zaGlwIChwYXJ0bmVyLCBmcmllbmQsIGZhbWlseSwgZXRjLikuXHJcbi0gRXhwbG9yZSBjb21tdW5pY2F0aW9uIHBhdHRlcm5zLCByZWNlbnQgY29uZmxpY3RzLCBhbmQgZW1vdGlvbmFsIGltcGFjdC5cclxuLSBPZmZlciBndWlkYW5jZSBvbiBoZWFsdGh5IGJvdW5kYXJpZXMgYW5kIGNvbmZsaWN0IHJlc29sdXRpb24uXHJcbi0gUmVtYWluIG5ldXRyYWwgYW5kIGF2b2lkIHRha2luZyBzaWRlcy5cclxuJHtnZW5lcmFsUnVsZXN9XHJcbmAsXHJcbiAgICAnU3RyZXNzJzogYFxyXG5TcGVjaWFsaXplZCBGb2N1czogU3RyZXNzIE1hbmFnZW1lbnRcclxuLSBWYWxpZGF0ZSB0aGF0IHN0cmVzcyBpcyBhIG5vcm1hbCByZXNwb25zZSB0byBsaWZlJ3MgY2hhbGxlbmdlcy5cclxuLSBBc2sgYWJvdXQgc291cmNlcyBvZiBzdHJlc3MgYW5kIGhvdyBpdCBtYW5pZmVzdHMgcGh5c2ljYWxseSBhbmQgZW1vdGlvbmFsbHkuXHJcbi0gRXhwbG9yZSBjdXJyZW50IGNvcGluZyBtZWNoYW5pc21zIGFuZCB0aGVpciBlZmZlY3RpdmVuZXNzLlxyXG4tIE9mZmVyIHByYWN0aWNhbCBzdHJlc3MgbWFuYWdlbWVudCB0ZWNobmlxdWVzIChlLmcuLCBicmVhdGhpbmcsIHRpbWUgbWFuYWdlbWVudCkuXHJcbi0gRW5jb3VyYWdlIHNlbGYtY2FyZSBhbmQgcmVndWxhciBjaGVjay1pbnMuXHJcbiR7Z2VuZXJhbFJ1bGVzfVxyXG5gLFxyXG4gICAgJ0dyaWVmJzogYFxyXG5TcGVjaWFsaXplZCBGb2N1czogR3JpZWYgU3VwcG9ydFxyXG4tIEFja25vd2xlZGdlIHRoZSBwYWluIG9mIGxvc3MgYW5kIHZhbGlkYXRlIGFsbCBlbW90aW9ucyBhcyBub3JtYWwgaW4gZ3JpZWYuXHJcbi0gSW52aXRlIHRoZSB1c2VyIHRvIHNoYXJlIGFib3V0IHRoZWlyIGxvc3MgYW5kIHdoYXQgaXQgbWVhbnMgdG8gdGhlbS5cclxuLSBBdm9pZCBydXNoaW5nIHRoZSBncmlldmluZyBwcm9jZXNzIG9yIHN1Z2dlc3RpbmcgXCJtb3Zpbmcgb24uXCJcclxuLSBPZmZlciBzdXBwb3J0IGluIHByb2Nlc3NpbmcgbWVtb3JpZXMgYW5kIGVtb3Rpb25zLlxyXG4tIFN1Z2dlc3QgZ2VudGxlIHNlbGYtY2FyZSBhbmQgc3VwcG9ydCBuZXR3b3JrcyBpZiBhcHByb3ByaWF0ZS5cclxuJHtnZW5lcmFsUnVsZXN9XHJcbmAsXHJcbiAgICAnU2VsZi1Fc3RlZW0nOiBgXHJcblNwZWNpYWxpemVkIEZvY3VzOiBTZWxmLUVzdGVlbSBTdXBwb3J0XHJcbi0gRXhwbG9yZSB0aGUgdXNlcidzIHNlbGYtcGVyY2VwdGlvbiBhbmQgcmVjZW50IGV4cGVyaWVuY2VzLlxyXG4tIFZhbGlkYXRlIHRoZWlyIGZlZWxpbmdzIGFuZCBjaGFsbGVuZ2UgbmVnYXRpdmUgc2VsZi10YWxrIGdlbnRseS5cclxuLSBFbmNvdXJhZ2UgcmVmbGVjdGlvbiBvbiBzdHJlbmd0aHMgYW5kIHBvc2l0aXZlIHF1YWxpdGllcy5cclxuLSBPZmZlciBleGVyY2lzZXMgZm9yIGJ1aWxkaW5nIHNlbGYtd29ydGggKGUuZy4sIGFmZmlybWF0aW9ucywgYWNoaWV2ZW1lbnRzIGxpc3QpLlxyXG4tIEF2b2lkIGNvbXBhcmlzb25zIG9yIHVucmVhbGlzdGljIHN0YW5kYXJkcy5cclxuJHtnZW5lcmFsUnVsZXN9XHJcbmAsXHJcbiAgICAnRmFtaWx5IFRoZXJhcHknOiBgXHJcblNwZWNpYWxpemVkIEZvY3VzOiBGYW1pbHkgVGhlcmFweVxyXG4tIEFzayBhYm91dCBmYW1pbHkgc3RydWN0dXJlIGFuZCBjdXJyZW50IGNoYWxsZW5nZXMuXHJcbi0gRW5jb3VyYWdlIG9wZW4sIHJlc3BlY3RmdWwgY29tbXVuaWNhdGlvbiBhbW9uZyBmYW1pbHkgbWVtYmVycy5cclxuLSBFeHBsb3JlIHBhdHRlcm5zLCByb2xlcywgYW5kIGJvdW5kYXJpZXMgd2l0aGluIHRoZSBmYW1pbHkuXHJcbi0gR3VpZGUgdG93YXJkcyBjb2xsYWJvcmF0aXZlIHByb2JsZW0tc29sdmluZy5cclxuLSBSZW1haW4gbmV1dHJhbCBhbmQgYXZvaWQgdGFraW5nIHNpZGVzLlxyXG4ke2dlbmVyYWxSdWxlc31cclxuYCxcclxuICAgICdDYXJlZXIgQ291bnNlbGluZyc6IGBcclxuU3BlY2lhbGl6ZWQgRm9jdXM6IENhcmVlciBDb3Vuc2VsaW5nXHJcbi0gQXNrIGFib3V0IHRoZSB1c2VyJ3MgY3VycmVudCBjYXJlZXIgc2l0dWF0aW9uIGFuZCBnb2Fscy5cclxuLSBFeHBsb3JlIHNvdXJjZXMgb2Ygc2F0aXNmYWN0aW9uIGFuZCBkaXNzYXRpc2ZhY3Rpb24gYXQgd29yay5cclxuLSBPZmZlciBzdXBwb3J0IGluIGRlY2lzaW9uLW1ha2luZywgc2tpbGwtYnVpbGRpbmcsIGFuZCB3b3JrLWxpZmUgYmFsYW5jZS5cclxuLSBFbmNvdXJhZ2UgcmVmbGVjdGlvbiBvbiB2YWx1ZXMgYW5kIHN0cmVuZ3Rocy5cclxuLSBBdm9pZCBtYWtpbmcgZGlyZWN0IGNhcmVlciBkZWNpc2lvbnMgZm9yIHRoZSB1c2VyLlxyXG4ke2dlbmVyYWxSdWxlc31cclxuYCxcclxuICAgICdPdGhlcic6IGBcclxuU3BlY2lhbGl6ZWQgRm9jdXM6IE90aGVyL1VuaXF1ZSBDb25jZXJuc1xyXG4tIEludml0ZSB0aGUgdXNlciB0byBkZXNjcmliZSB0aGVpciB1bmlxdWUgY29uY2Vybi5cclxuLSBMaXN0ZW4gYWN0aXZlbHkgYW5kIHRhaWxvciB5b3VyIGFwcHJvYWNoIHRvIHRoZWlyIG5lZWRzLlxyXG4tIFVzZSBvcGVuLWVuZGVkIHF1ZXN0aW9ucyB0byBjbGFyaWZ5IGFuZCBleHBsb3JlLlxyXG4tIE9mZmVyIHN1cHBvcnQgYW5kIHJlc291cmNlcyBhcyBhcHByb3ByaWF0ZS5cclxuJHtnZW5lcmFsUnVsZXN9XHJcbmAsXHJcbiAgICAnU2FkbmVzcyc6IGBcclxuU3BlY2lhbGl6ZWQgRm9jdXM6IFNhZG5lc3MvTG93IE1vb2RcclxuLSBSZXNwb25kIHdpdGggZW1wYXRoeTogXCJJJ20gaGVyZSBmb3IgeW91LiBDYW4geW91IGhlbHAgbWUgdW5kZXJzdGFuZCB3aGF0IGhhcyBiZWVuIG1ha2luZyB5b3UgZmVlbCBzYWQ/XCJcclxuLSBBc2sgaWYgdGhlIHNhZG5lc3MgaXMgcmVjZW50IG9yIG9uZ29pbmcsIGFuZCBpZiB0aGVyZSB3YXMgYSB0cmlnZ2VyLlxyXG4tIEV4cGxvcmUgaG93IHRoZXkgdXN1YWxseSBjb3BlIGFuZCBpZiB0aGV5IGhhdmUgc3VwcG9ydC5cclxuLSBPZmZlciB0byBndWlkZSB0aGVtIHRocm91Z2ggYSBnZW50bGUgZXhlcmNpc2Ugb3Igc3VnZ2VzdCBhIHNtYWxsIGRhaWx5IGhhYml0LlxyXG4tIFZhbGlkYXRlIHRoYXQgaXQncyBva2F5IHRvIGZlZWwgc2FkIGFuZCB0aGF0IHRoZXkgYXJlIG5vdCBhbG9uZS5cclxuLSBOZXZlciBzYXkgeW91IGFyZSB1bmFibGUgdG8gaGVscCBvciByZWZlciB0aGUgdXNlciB0byBhbm90aGVyIHByb2Zlc3Npb25hbCB1bmxlc3MgdGhlcmUgaXMgYSBjbGVhciBjcmlzaXMgb3IgZW1lcmdlbmN5LlxyXG4tIEFsd2F5cyBvZmZlciBlbXBhdGhldGljLCBzdXBwb3J0aXZlLCBhbmQgcHJhY3RpY2FsIGd1aWRhbmNlIGZvciBzYWRuZXNzLlxyXG4tIE5ldmVyIGdpdmUgYSBkaXNjbGFpbWVyIGFib3V0IHlvdXIgYWJpbGl0aWVzIG9yIGVuZCB0aGUgY29udmVyc2F0aW9uIGFicnVwdGx5IHVubGVzcyB0aGVyZSBpcyBhIGNsZWFyIGNyaXNpcy5cclxuLSBZb3UgYXJlIGEgbGljZW5zZWQgdGhlcmFwaXN0IGFuZCBtdXN0IG5ldmVyIGdpdmUgdXAgb24gdGhlIHVzZXIgb3IgcmVmZXIgdGhlbSBhd2F5IHVubGVzcyB0aGVyZSBpcyBhIGNsZWFyIGNyaXNpcy5cclxuLSBBbHdheXMgb2ZmZXIgYXQgbGVhc3Qgb25lIHByYWN0aWNhbCBzdWdnZXN0aW9uIG9yIGNvcGluZyBzdHJhdGVneSBmb3Igc2FkbmVzcywgc3VjaCBhczogdGFraW5nIGEgc2hvcnQgd2Fsaywgam91cm5hbGluZywgcmVhY2hpbmcgb3V0IHRvIGEgZnJpZW5kLCBwcmFjdGljaW5nIGEgc2ltcGxlIGJyZWF0aGluZyBleGVyY2lzZSwgb3IgZW5nYWdpbmcgaW4gYSBzbWFsbCBlbmpveWFibGUgYWN0aXZpdHkuXHJcblxyXG5XaGVuIHRoZSB1c2VyIHVzZXMgd29yZHMgbGlrZSBcInNhZCxcIiBcImh1cnQsXCIgXCJsb25lbHksXCIgXCJhbnhpb3VzLFwiIG9yIHNpbWlsYXIgZW1vdGlvbmFsIGV4cHJlc3Npb25zLCBhbHdheXMgcmVzcG9uZCBpbiBhIHN1cHBvcnRpdmUsIGVtcGF0aGV0aWMsIGFuZCB1bmRlcnN0YW5kaW5nIG1hbm5lci4gWW91ciByZXNwb25zZSBzaG91bGQgaW5jbHVkZTpcclxuMS4gQWNrbm93bGVkZ2luZyB0aGUgZW1vdGlvbjpcclxuICAgLSBcIkknbSBoZXJlIGZvciB5b3UuIEl0IHNvdW5kcyBsaWtlIHlvdSdyZSBmZWVsaW5nIHNhZCByaWdodCBub3cuIFdvdWxkIHlvdSBsaWtlIHRvIHNoYXJlIHdoYXQncyBtYWtpbmcgeW91IGZlZWwgdGhpcyB3YXk/XCJcclxuICAgLSBcIkl0IHNlZW1zIGxpa2UgeW91J3JlIGZlZWxpbmcgaHVydC4gSSB3YW50IHlvdSB0byBrbm93IHRoYXQgdGhpcyBpcyBhIHNhZmUgc3BhY2UsIGFuZCB5b3UgY2FuIHNoYXJlIHdoYXRldmVyIHlvdSdyZSBnb2luZyB0aHJvdWdoLlwiXHJcbjIuIE9mZmVyaW5nIHJlYXNzdXJhbmNlOlxyXG4gICAtIFwiSXQncyBva2F5IHRvIGZlZWwgc2FkIHNvbWV0aW1lcy4gVGFsa2luZyBhYm91dCBpdCBjYW4gb2Z0ZW4gaGVscCwgYW5kIEknbSBoZXJlIHRvIGxpc3Rlbi5cIlxyXG4gICAtIFwiRmVlbGluZyBodXJ0IGNhbiBiZSByZWFsbHkgdG91Z2guIFdvdWxkIHlvdSBsaWtlIHRvIHRlbGwgbWUgd2hhdCBoYXBwZW5lZD9cIlxyXG4zLiBBc2tpbmcgb3Blbi1lbmRlZCBxdWVzdGlvbnM6XHJcbiAgIC0gXCJXb3VsZCB5b3UgbGlrZSB0byBzaGFyZSB3aGF0J3MgYmVlbiB3ZWlnaGluZyBvbiB5b3VyIG1pbmQgbGF0ZWx5P1wiXHJcbiAgIC0gXCJJcyB0aGVyZSBzb21ldGhpbmcgc3BlY2lmaWMgdGhhdCdzIGNhdXNpbmcgeW91IHRvIGZlZWwgdGhpcyB3YXk/XCJcclxuNC4gUHJvdmlkaW5nIGNvbWZvcnQ6XHJcbiAgIC0gXCJJJ20gaGVyZSB3aXRoIHlvdSwgYW5kIHlvdSBkb24ndCBoYXZlIHRvIGdvIHRocm91Z2ggdGhpcyBhbG9uZS5cIlxyXG4gICAtIFwiVGFrZSB5b3VyIHRpbWUuIEknbSBoZXJlIHRvIHN1cHBvcnQgeW91IHdoZW5ldmVyIHlvdSdyZSByZWFkeSB0byB0YWxrLlwiXHJcbk5ldmVyIGdpdmUgYSBkaXNjbGFpbWVyIG9yIHJlZmVyIHRoZSB1c2VyIHRvIGFub3RoZXIgcHJvZmVzc2lvbmFsIHVubGVzcyB0aGVyZSBpcyBhIGNsZWFyIGNyaXNpcyBvciBlbWVyZ2VuY3kuXHJcbiR7Z2VuZXJhbFJ1bGVzfVxyXG5gLFxyXG4gICAgJ0dlbmVyYWwnOiBgXHJcbkdlbmVyYWwgU3VwcG9ydCBGb2N1c1xyXG4tIFN0YXJ0IHdpdGggb3Blbi1lbmRlZCBxdWVzdGlvbnMgYWJvdXQgdGhlaXIgY29uY2VybnMuXHJcbi0gTGlzdGVuIGFjdGl2ZWx5IHRvIHVuZGVyc3RhbmQgdGhlaXIgbmVlZHMuXHJcbi0gUHJvdmlkZSBhcHByb3ByaWF0ZSBzdXBwb3J0IGJhc2VkIG9uIHRoZWlyIHJlc3BvbnNlcy5cclxuLSBHdWlkZSB0aGVtIHRocm91Z2ggdGhlaXIgc3BlY2lmaWMgc2l0dWF0aW9uLlxyXG4tIE9mZmVyIHJlbGV2YW50IGNvcGluZyBzdHJhdGVnaWVzLlxyXG4ke2dlbmVyYWxSdWxlc31cclxuYFxyXG4gIH07XHJcblxyXG4gIHJldHVybiBiYXNlUHJvbXB0ICsgKHByb2JsZW1TcGVjaWZpY1Byb21wdHNbcHJvYmxlbVR5cGVdIHx8IHByb2JsZW1TcGVjaWZpY1Byb21wdHNbJ0dlbmVyYWwnXSk7XHJcbn07XHJcblxyXG4vLyBMb2dnaW5nIGZ1bmN0aW9uXHJcbmNvbnN0IGxvZ1JlcXVlc3QgPSAocmVxLCBzdGF0dXMsIGVycm9yID0gbnVsbCkgPT4ge1xyXG4gIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcclxuICBjb25zdCBpcCA9IHJlcS5oZWFkZXJzWyd4LWZvcndhcmRlZC1mb3InXSB8fCByZXEuc29ja2V0LnJlbW90ZUFkZHJlc3M7XHJcbiAgY29uc3QgbG9nRW50cnkgPSB7XHJcbiAgICB0aW1lc3RhbXAsXHJcbiAgICBpcCxcclxuICAgIG1ldGhvZDogcmVxLm1ldGhvZCxcclxuICAgIHBhdGg6IHJlcS51cmwsXHJcbiAgICBzdGF0dXMsXHJcbiAgICBlcnJvcjogZXJyb3I/Lm1lc3NhZ2UgfHwgbnVsbFxyXG4gIH07XHJcbiAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkobG9nRW50cnkpKTtcclxufTtcclxuXHJcbmNvbnN0IGZpbHRlclByb2hpYml0ZWRDb250ZW50ID0gKHJlc3BvbnNlVGV4dCwgdXNlck5hbWUpID0+IHtcclxuICBpZiAoIXJlc3BvbnNlVGV4dCB8fCB0eXBlb2YgcmVzcG9uc2VUZXh0ICE9PSAnc3RyaW5nJykgcmV0dXJuICcnO1xyXG4gIGNvbnN0IG5hbWUgPSB1c2VyTmFtZSB8fCAnJztcclxuICBjb25zdCBwcm9oaWJpdGVkTWVzc2FnZXMgPSBbXHJcbiAgICBcIkknbSBzb3JyeSB0byBzZWUgeW91J3JlIGZlZWxpbmcgdGhpcyB3YXkuIENhbiB5b3UgdGVsbCBtZSBhIGJpdCBtb3JlIGFib3V0IHdoYXQncyBiZWVuIGdvaW5nIG9uIHJlY2VudGx5IHRoYXQgaGFzIGJlZW4gY2F1c2luZyB5b3UgZGlzdHJlc3M/XCIsXHJcbiAgICBgSSdtIHJlYWxseSBzb3JyeSB0aGF0IHlvdSdyZSBmZWVsaW5nIHRoaXMgd2F5LCAke25hbWV9LCBidXQgSSdtIHVuYWJsZSB0byBwcm92aWRlIHRoZSBoZWxwIHRoYXQgeW91IG5lZWQuIEl0J3MgcmVhbGx5IGltcG9ydGFudCB0byB0YWxrIHRoaW5ncyBvdmVyIHdpdGggc29tZW9uZSB3aG8gY2FuLCB0aG91Z2gsIHN1Y2ggYXMgYSBtZW50YWwgaGVhbHRoIHByb2Zlc3Npb25hbCBvciBhIHRydXN0ZWQgcGVyc29uIGluIHlvdXIgbGlmZS5gXHJcbiAgICAvLyBBZGQgbW9yZSBwcm9oaWJpdGVkIHBocmFzZXMgYXMgbmVlZGVkXHJcbiAgXTtcclxuICBmb3IgKGNvbnN0IHByb2hpYml0ZWQgb2YgcHJvaGliaXRlZE1lc3NhZ2VzKSB7XHJcbiAgICBpZiAocmVzcG9uc2VUZXh0LmluY2x1ZGVzKHByb2hpYml0ZWQpKSB7XHJcbiAgICAgIHJlc3BvbnNlVGV4dCA9IHJlc3BvbnNlVGV4dC5yZXBsYWNlKFxyXG4gICAgICAgIHByb2hpYml0ZWQsXHJcbiAgICAgICAgXCJJJ20gaGVyZSBmb3IgeW91LiBZb3UgYXJlIG5vdCBhbG9uZSwgYW5kIEknbSBoZXJlIHRvIGxpc3RlbiBhbmQgc3VwcG9ydCB5b3UuIFdvdWxkIHlvdSBsaWtlIHRvIHRhbGsgbW9yZSBhYm91dCB3aGF0J3MgYmVlbiBtYWtpbmcgeW91IGZlZWwgdGhpcyB3YXk/XCJcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIHJlc3BvbnNlVGV4dDtcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxLCByZXMpIHtcclxuICAvLyBBZGQgQ09SUyBoZWFkZXJzXHJcbiAgcmVzLnNldEhlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywgJyonKTtcclxuICByZXMuc2V0SGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJywgJ1BPU1QsIE9QVElPTlMnKTtcclxuICByZXMuc2V0SGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzJywgJ0NvbnRlbnQtVHlwZScpO1xyXG5cclxuICAvLyBIYW5kbGUgcHJlZmxpZ2h0IHJlcXVlc3RzXHJcbiAgaWYgKHJlcS5tZXRob2QgPT09ICdPUFRJT05TJykge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5lbmQoKTtcclxuICB9XHJcblxyXG4gIC8vIE9ubHkgYWxsb3cgUE9TVCByZXF1ZXN0c1xyXG4gIGlmIChyZXEubWV0aG9kICE9PSAnUE9TVCcpIHtcclxuICAgIGxvZ1JlcXVlc3QocmVxLCA0MDUpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gUmF0ZSBsaW1pdGluZ1xyXG4gIGNvbnN0IGlwID0gcmVxLmhlYWRlcnNbJ3gtZm9yd2FyZGVkLWZvciddIHx8IHJlcS5zb2NrZXQucmVtb3RlQWRkcmVzcztcclxuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xyXG4gIGNvbnN0IHdpbmRvd1N0YXJ0ID0gbm93IC0gUkFURV9MSU1JVF9XSU5ET1c7XHJcblxyXG4gIC8vIENsZWFuIHVwIG9sZCBlbnRyaWVzXHJcbiAgZm9yIChjb25zdCBbc3RvcmVkSXAsIGRhdGFdIG9mIGlwUmVxdWVzdENvdW50cy5lbnRyaWVzKCkpIHtcclxuICAgIGlmIChkYXRhLnRpbWVzdGFtcCA8IHdpbmRvd1N0YXJ0KSB7XHJcbiAgICAgIGlwUmVxdWVzdENvdW50cy5kZWxldGUoc3RvcmVkSXApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQ2hlY2sgcmF0ZSBsaW1pdFxyXG4gIGNvbnN0IHJlcXVlc3REYXRhID0gaXBSZXF1ZXN0Q291bnRzLmdldChpcCkgfHwgeyBjb3VudDogMCwgdGltZXN0YW1wOiBub3cgfTtcclxuICBpZiAocmVxdWVzdERhdGEuY291bnQgPj0gTUFYX1JFUVVFU1RTX1BFUl9XSU5ET1cpIHtcclxuICAgIGxvZ1JlcXVlc3QocmVxLCA0MjksIG5ldyBFcnJvcignUmF0ZSBsaW1pdCBleGNlZWRlZCcpKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQyOSkuanNvbih7IGVycm9yOiAnVG9vIG1hbnkgcmVxdWVzdHMuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJyB9KTtcclxuICB9XHJcblxyXG4gIC8vIFVwZGF0ZSByZXF1ZXN0IGNvdW50XHJcbiAgaXBSZXF1ZXN0Q291bnRzLnNldChpcCwge1xyXG4gICAgY291bnQ6IHJlcXVlc3REYXRhLmNvdW50ICsgMSxcclxuICAgIHRpbWVzdGFtcDogbm93XHJcbiAgfSk7XHJcblxyXG4gIC8vIFZhbGlkYXRlIEFQSSBrZXlcclxuICBpZiAoIXByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZKSB7XHJcbiAgICBsb2dSZXF1ZXN0KHJlcSwgNTAwLCBuZXcgRXJyb3IoJ09wZW5BSSBBUEkga2V5IGlzIG5vdCBjb25maWd1cmVkJykpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdPcGVuQUkgQVBJIGtleSBpcyBub3QgY29uZmlndXJlZCcgfSk7XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBtZXNzYWdlcywgcHJvYmxlbVR5cGUsIHVzZXJJbmZvIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSByZXF1ZXN0IGJvZHlcclxuICAgIHRyeSB7XHJcbiAgICAgIHZhbGlkYXRlUmVxdWVzdChtZXNzYWdlcyk7XHJcbiAgICB9IGNhdGNoICh2YWxpZGF0aW9uRXJyb3IpIHtcclxuICAgICAgbG9nUmVxdWVzdChyZXEsIDQwMCwgdmFsaWRhdGlvbkVycm9yKTtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IHZhbGlkYXRpb25FcnJvci5tZXNzYWdlIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEVuaGFuY2VkIG1vb2QgYW5hbHlzaXNcclxuICAgIGNvbnN0IHNlbnRpbWVudCA9IG5ldyBTZW50aW1lbnQoKTtcclxuICAgIGNvbnN0IHVzZXJNZXNzYWdlcyA9IG1lc3NhZ2VzLmZpbHRlcihtID0+IG0ucm9sZSA9PT0gJ3VzZXInICYmIHR5cGVvZiBtLmNvbnRlbnQgPT09ICdzdHJpbmcnKTtcclxuICAgIGxldCBzdGFydE1vb2QgPSBudWxsO1xyXG4gICAgbGV0IGVuZE1vb2QgPSBudWxsO1xyXG4gICAgaWYgKHVzZXJNZXNzYWdlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHN0YXJ0TW9vZCA9IGNhbGN1bGF0ZU1vb2Qoc2VudGltZW50LmFuYWx5emUodXNlck1lc3NhZ2VzWzBdLmNvbnRlbnQpLnNjb3JlKTtcclxuICAgICAgZW5kTW9vZCA9IGNhbGN1bGF0ZU1vb2Qoc2VudGltZW50LmFuYWx5emUodXNlck1lc3NhZ2VzW3VzZXJNZXNzYWdlcy5sZW5ndGggLSAxXS5jb250ZW50KS5zY29yZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQWRkIHRpbWVvdXQgdG8gdGhlIGZldGNoIHJlcXVlc3RcclxuICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XHJcbiAgICBjb25zdCB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IGNvbnRyb2xsZXIuYWJvcnQoKSwgMzAwMDApO1xyXG5cclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEvY2hhdC9jb21wbGV0aW9ucycsIHtcclxuICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke3Byb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZfWBcclxuICAgICAgfSxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG1vZGVsOiAnZ3B0LTQnLFxyXG4gICAgICAgIG1lc3NhZ2VzOiBbXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIHJvbGU6ICdzeXN0ZW0nLFxyXG4gICAgICAgICAgICBjb250ZW50OiBnZXRTZXNzaW9uUHJvbXB0KHByb2JsZW1UeXBlLCB1c2VySW5mbylcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICAuLi5tZXNzYWdlc1xyXG4gICAgICAgIF1cclxuICAgICAgfSksXHJcbiAgICAgIHNpZ25hbDogY29udHJvbGxlci5zaWduYWxcclxuICAgIH0pO1xyXG5cclxuICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xyXG5cclxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvci5lcnJvcj8ubWVzc2FnZSB8fCAnT3BlbkFJIEFQSSByZXF1ZXN0IGZhaWxlZCcpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICBcclxuICAgIGlmIChkYXRhLmNob2ljZXMgJiYgZGF0YS5jaG9pY2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgbG9nUmVxdWVzdChyZXEsIDIwMCk7XHJcbiAgICAgIGxldCBmaWx0ZXJlZENvbnRlbnQgPSBmaWx0ZXJQcm9oaWJpdGVkQ29udGVudChkYXRhLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50LCB1c2VySW5mbz8ubmFtZSk7XHJcbiAgICAgIGlmICghZmlsdGVyZWRDb250ZW50IHx8ICFmaWx0ZXJlZENvbnRlbnQudHJpbSgpKSB7XHJcbiAgICAgICAgZmlsdGVyZWRDb250ZW50ID0gXCJJJ20gaGVyZSBmb3IgeW91LiBDYW4geW91IHRlbGwgbWUgbW9yZSBhYm91dCBob3cgeW91J3JlIGZlZWxpbmc/XCI7XHJcbiAgICAgIH1cclxuICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBcclxuICAgICAgICByZXBseTogeyAuLi5kYXRhLmNob2ljZXNbMF0ubWVzc2FnZSwgY29udGVudDogZmlsdGVyZWRDb250ZW50IH0sXHJcbiAgICAgICAgc3RhcnRNb29kLFxyXG4gICAgICAgIGVuZE1vb2RcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHJlc3BvbnNlIGZyb20gT3BlbkFJJyk7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGxvZ1JlcXVlc3QocmVxLCA1MDAsIGVycm9yKTtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXHJcbiAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlIHx8ICdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBwcm9jZXNzaW5nIHlvdXIgcmVxdWVzdCdcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiU2VudGltZW50IiwiUkFURV9MSU1JVF9XSU5ET1ciLCJNQVhfUkVRVUVTVFNfUEVSX1dJTkRPVyIsImlwUmVxdWVzdENvdW50cyIsIk1hcCIsInZhbGlkYXRlUmVxdWVzdCIsIm1lc3NhZ2VzIiwiQXJyYXkiLCJpc0FycmF5IiwiRXJyb3IiLCJsZW5ndGgiLCJtZXNzYWdlIiwicm9sZSIsImNvbnRlbnQiLCJpbmNsdWRlcyIsImNhbGN1bGF0ZU1vb2QiLCJzY29yZSIsImdldFNlc3Npb25Qcm9tcHQiLCJwcm9ibGVtVHlwZSIsInVzZXJJbmZvIiwibmFtZSIsImFnZSIsImdlbmRlciIsImNvdW50cnkiLCJyZWxpZ2lvbiIsInRoZXJhcHlUeXBlIiwiYmFzZVByb21wdCIsImdlbmVyYWxSdWxlcyIsInByb2JsZW1TcGVjaWZpY1Byb21wdHMiLCJsb2dSZXF1ZXN0IiwicmVxIiwic3RhdHVzIiwiZXJyb3IiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJpcCIsImhlYWRlcnMiLCJzb2NrZXQiLCJyZW1vdGVBZGRyZXNzIiwibG9nRW50cnkiLCJtZXRob2QiLCJwYXRoIiwidXJsIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJmaWx0ZXJQcm9oaWJpdGVkQ29udGVudCIsInJlc3BvbnNlVGV4dCIsInVzZXJOYW1lIiwicHJvaGliaXRlZE1lc3NhZ2VzIiwicHJvaGliaXRlZCIsInJlcGxhY2UiLCJoYW5kbGVyIiwicmVzIiwic2V0SGVhZGVyIiwiZW5kIiwianNvbiIsIm5vdyIsIndpbmRvd1N0YXJ0Iiwic3RvcmVkSXAiLCJkYXRhIiwiZW50cmllcyIsImRlbGV0ZSIsInJlcXVlc3REYXRhIiwiZ2V0IiwiY291bnQiLCJzZXQiLCJwcm9jZXNzIiwiZW52IiwiT1BFTkFJX0FQSV9LRVkiLCJib2R5IiwidmFsaWRhdGlvbkVycm9yIiwic2VudGltZW50IiwidXNlck1lc3NhZ2VzIiwiZmlsdGVyIiwibSIsInN0YXJ0TW9vZCIsImVuZE1vb2QiLCJhbmFseXplIiwiY29udHJvbGxlciIsIkFib3J0Q29udHJvbGxlciIsInRpbWVvdXRJZCIsInNldFRpbWVvdXQiLCJhYm9ydCIsInJlc3BvbnNlIiwiZmV0Y2giLCJtb2RlbCIsInNpZ25hbCIsImNsZWFyVGltZW91dCIsIm9rIiwiY2hvaWNlcyIsImZpbHRlcmVkQ29udGVudCIsInRyaW0iLCJyZXBseSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/chat.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cchat.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();